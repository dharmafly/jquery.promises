<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>jQuery.promises</title>
    <meta name="description" content="jQuery.promises: A collection of little scripts that use jQuery.Deferred for cleaner, encapsulated flow control">
    <meta name="author" content="Dharmafly">

    <!-- HTML5 shim -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/styles.css" rel="stylesheet">

    <!-- Le fav and touch icons -->
    <link rel="shortcut icon" href="images/favicon.ico">
    <link rel="apple-touch-icon" href="images/apple-touch-icon.png">
    <link rel="apple-touch-icon" sizes="72x72" href="images/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="114x114" href="images/apple-touch-icon-114x114.png">
  </head>

  <body>

    <!-- Navbar -->

    <div class="navbar navbar-fixed">
      <div class="navbar-inner">
        <div class="fluid-container">
          <a class="brand" href="#">jQuery.promises</a>
          <ul class="nav">
            <li class="active"><a href="#">Home</a></li>
            <li><a href="#docs">Documentation</a></li>
            <li><a href="https://github.com/dharmafly/jquery.promises">Download</a></li>
          </ul>
        </div>
      </div>
    </div>

    <!-- Container -->

    <div class="fluid-container sidebar-left">
      <div class="fluid-sidebar">
        <div class="well side-nav">
          <h5 class="nav-label"><a class="nav-item" href="#overview">Overview</a></h5>

          <h5 class="nav-label"><a href="#image">jQuery.promises.image</a></h5>
          <ul class="nav-group">
            <li><a class="nav-item" href="#image-example-1">example #1</a></li>
            <li><a class="nav-item" href="#image-example-2">example #2</a></li>
            <li><a class="nav-item" href="#image-example-3">example #3</a></li>
          </ul>

          <h5 class="nav-label"><a href="#timer">jQuery.promises.timer</a></h5>
          <ul class="nav-group">
            <li><a class="nav-item" href="#timer-example-1">example #1</a></li>
            <li><a class="nav-item" href="#timer-example-2">example #2</a></li>
            <li><a class="nav-item" href="#timer-example-3">example #3</a></li>
          </ul>
        </div>
      </div>
      <div class="fluid-content">

        <!-- Project introduction-->
        <div class="hero-unit">
          <h1 id="overview">Introducing promises</h1>
          <p>Asynchronous code in JavaScript is often handled with nested callback functions. This works fine but can easily lead to messy code when you encounter flow control. <a href="http://wiki.commonjs.org/wiki/Promises/A" target="_blank">Promises</a> are useful objects that allow us to write asynchronously much more easily by adopting a type of flow control which eliminates deeply nested callbacks.</p>
          <p>In the recent version of jQuery, some of it's asynchronous methods like <a href="http://api.jquery.com/jQuery.get" target="_blank">jQuery.get</a> return a promise object that we can hook our next non/asynchronous function. We can do this using the promise's <code>then</code> method like so...</p>
          <pre>
jQuery.get('foo.txt')
      .then(success, failure);</pre>
          <p>A <a href="http://api.jquery.com/category/deferred-object/" target="_blank">jQuery.Deferred</a> object is used to manage the state of a promise. Promises can have multiple states handled by its Deferred object and these states relate to triggered callbacks seen in the <code>then</code> method.</p>
          <p>The states of a promise range from being <em>unfulfilled</em>, <em>fulfilled</em>, and <em>failed</em>. In the example code above it is up to an internal Deferred object of <code>get</code> to constitute when its promise is <em>fulfilled</em> or <em>failed</em>.</p>
          <h3>jQuery.promises</h3>
          <p>So just like <a href="http://api.jquery.com/jQuery.get" target="_blank">jQuery.get</a> has done, we too can wrap a Deferred and return its promise to create a unified interface for asynchronous flow control.</p>
          <p>This is what <b>jQuery.promises</b> aims to do by providing a number of tiny but useful wrappers around common objects which can be used with the promise interface. Currently, there are only two wrappers; <a href="#image">jQuery.promises.image</a> and <a href="#timer">jQuery.promises.timer</a>.</p>
          <p><a class="btn primary large" href="https://github.com/dharmafly/jquery.promises">GitHub repo &raquo;</a></p>
        </div>

        <hr>

        <!-- jQuery.promises.image -->
        <h2 id="image">jQuery.promises.image</h2>
        <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.</p>

        <section id="image-example-1">
          <h3>Example #1</h3>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
          <div class="code-example"><pre>jQuery.promises.image("http://farm3.staticflickr.com/2188/2219660409_21ba876f98_m.jpg")
    .then(
        function(img){
            jQuery(img).appendTo('#image-example-1 .result');
        },
        function(){
            alert("Image failed to load");
        }
    );</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

        <section id="image-example-2">
          <h3>Example #2</h3>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.</p>
            <div class="code-example"><pre>jQuery.when(
      jQuery.promises.image("http://farm3.staticflickr.com/2188/2219660409_21ba876f98_m.jpg"),
      jQuery.promises.image("http://farm3.staticflickr.com/2102/2183461799_beff4bb413_m.jpg"),
      jQuery.get("example.json")
  )
  .then(
      function(img1, img2, json){
          jQuery("#image-example-2 .result")
              .append(img1)
              .append(img2)
              .append("&lt;code>" + json[0].foo + "&lt;/code>");
      },
      function(){
          alert("Something failed to load");
      }
  );</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

        <section id="image-example-3">
          <h3>Example #3</h3>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
              <div class="code-example"><pre>jQuery.promises.image(
      [
          "http://farm3.staticflickr.com/2188/2219660409_21ba876f98_m.jpg",
          "http://farm3.staticflickr.com/2102/2183461799_beff4bb413_m.jpg",
          "http://farm1.staticflickr.com/73/175573986_f5073bfcb0_m.jpg"
      ],

      // Success callback - called if all images load successfully
      // image elements are passed as arguments in the same order as above
      function(){
          jQuery(arguments)
              .hide()
              .appendTo("#image-example-3 .result")
              .fadeIn(1000);
      },

      // Fail callback - called if one or more images fail to load
      function(){
          alert("An image failed to load");
      }
  );</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

        <hr>

        <!-- jQuery.promises.timer -->
          <h2 id="timer">jQuery.promises.timer</h2>
          <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.</p>


          <section id="timer-example-1">
            <h3 id="jQuery.promises.timer-ex1">Example #1</h3>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
            <div class="code-example"><pre>jQuery.promises.timer(
      // milliseconds
      500,

      // Success callback
      function(){
          alert("Success!");
      },

      // Fail callback
      function(){
          alert("Error!");
      }
  );</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

          <section id="timer-example-2">
            <h3>Example #2</h3>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
            <div class="code-example"><pre>var resultElem = jQuery("#timer-example-2 .result"),
      flag = window.flagBg;

  jQuery.promises.timer(

      // milliseconds
      500,

      // Success callback
      function(){
          // Toggle body background-colour from yellow to green
          resultElem.css({
              backgroundColor: flag ?
                  "#fff9a6" : "#aaffaa"
          });

          window.flagBg = !flag
      },

      // Fail callback
      function(){
          alert("Error");
      }
  );</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

          <section id="timer-example-3">
            <h3 id="jQuery.promises.timer-ex3">Example #3</h3>
            <p>Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui. </p>
            <div class="code-example"><pre>var images = [
          "http://farm3.staticflickr.com/2188/2219660409_21ba876f98_m.jpg",
          "http://farm3.staticflickr.com/2102/2183461799_beff4bb413_m.jpg",
          "http://farm1.staticflickr.com/73/175573986_f5073bfcb0_m.jpg"
      ],
      current = 0;

  function loadAndDisplay(src){
      jQuery.when(
          jQuery.promises.image(src),
          jQuery.promises.timer(1000)
      )
      .then(
          function(img){
              jQuery(img)
                  // Hide image and then display it
                  .hide()
                  .fadeIn(500, function(){

                      // Once faded in, load next image
                      current ++;

                      // Reset loop to first image
                      if (current >= images.length){
                          current = 0;
                      }

                      // Load and display the next image
                      loadAndDisplay(images[current]);
                  });

              jQuery("#timer-example-3 .result").html(img);
          },

          function(){
              alert("Error");
          }
      );
  }

  loadAndDisplay(images[current]);</pre></div>

            <section class="result">
              <button class="btn run-code" href="#">Run &raquo;</button> <br> <br>
              Donec id elit non mi porta gravida at eget metus. Fusce dapibus, tellus ac cursus commodo, tortor mauris condimentum nibh, ut fermentum massa justo sit amet risus. Etiam porta sem malesuada magna mollis euismod. Donec sed odio dui.
            </section>
          </section>

        </div> <!-- /container -->
      </div>

	<!-- jQuery + jQuery.promises -->
	<script src="js/jquery.js"></script>
    <script src="https://raw.github.com/dharmafly/jquery.promises/master/image.js"></script>
    <script src="https://raw.github.com/dharmafly/jquery.promises/master/timer.js"></script>

	<!-- Demo code snippets -->
    <script src="js/ace/ace.js"></script>
    <script src="js/ace/theme/theme-monokai.js"></script>
    <script src="js/ace/mode-javascript.js"></script>
    <script src="js/demo.js"></script>

	<!-- ga -->
	<script>
	  var _gaq = _gaq || [];
	  _gaq.push(['_setAccount', 'UA-2150808-19']);
	  _gaq.push(['_trackPageview']);

	  (function() {
	    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
	    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
	    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
	  })();
	</script>
  </body>
</html>
