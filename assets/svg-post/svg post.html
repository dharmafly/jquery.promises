<p>In its many projects, Dharmafly creates many useful and reusable code modules. These often get released as open source projects with accompanying documentation and websites.</p>

<p>In order to give these a common feel and to update many of the smaller projects, I was tasked with creating a reusable template set for easily creating new project websites based on site documentation. You can see a couple of example Dharmafly projects sites for <a href="http://jquerypromises.com/">jQuery.promises</a> and <a href="http://dharmafly.github.com/pablo">Pablo</a>. <img src="images/jqpromises-header-small.png" alt="Jquery promises" title=""></p>

<p>Given the designs for the site included flat-colour, line-based graphic elements that varied according to a colour theme, it made sense to attempt to apply these with SVG.</p>

<h2>What's SVG?</h2>

<p>SVG (Scalable Vector Graphics) are graphic imagery created from a readable definition of the lines, colours and points involved, rather than a binary file containing a description of every pixel. </p>

<p>As the images are defined as lines and points, these have the advantage of being editable as text, rather than editing by opening up Photoshop to make changes. </p>

<p>To add these graphics to the page, we used a variety of techniques that make use of SVG. Beyond creating graphics, we also used SVG to manipulate existing static images to emulate techniques that would have been used in the original Photoshop designs.</p>

<h2>Beyond Photoshop</h2>

<p>Many techniques formally available only to image editing programmes (blur, greyscale) are now available within the browser, using SVG. This means that instead of cutting flat, uneditable graphics and using these in a web page, developers can now read the designer's <em>intention</em> from the Photoshop file and apply this in the browser.</p>

<p>So, instead of using a desaturated image with a semi-transparent overlay, we now have the original asset, desaturated in the browser and given a semi-transparent overlay. </p>

<p>The advantage is that many aspects of the original image, such as colour, transparency level, can be changed in many versions of the site without creating new assets. </p>

<h2>Adding elements to the page</h2>

<p>Having considered SVG as a choice for colour-themed line-based graphics, we now had to decide how to apply these to the page.</p>

<p><a href="http://msdn.microsoft.com/en-us/library/gg589526(v=vs.85).aspx#inlineHTML5">SVG can be added directly</a> to a page using HTML5, however with the same element used multiple times and at multiple sizes and rotation, <img src="images/nodewing-variations.png" alt="Variations on the SVG element" title=""> a method would need to be used that would allow these changes using a single, cacheable asset.</p>

<p>The alternative implementations would be adding to the page using <code>object</code> and <code>img</code> elements, which allow caching of the SVG file. <code>object</code> allows you to specify fallbacks if SVG is not supported. An <code>img</code> element would have the same caching advantage, but [prevents links within the SVG working] (http://www.sitepoint.com/add-svg-to-web-page/) (an <code>img</code> element would be lighter). In both cases, the SVG DOM nodes are not part of the <code>document</code>, but the <code>object</code> and <code>img</code> elements would be.</p>

<p>Given the graphical elements within our designs were not interactive and were purely decorative, we chose to add them using CSS <code>background-image</code>. This way the SVG file would be cached, and could be manipulated visually (as a whole) using CSS rules. The SVG element would be semantically separate from the page in a way that the direct, <code>object</code> and <code>img</code> techniques would not.</p>

<p>The chief advantage in our case was that multiple instances of the same asset can be loaded once, reused, coloured and transformed and scaled to create very many decorative elements.</p>

<h2>Adding less complex decorative elements</h2>

<p>The main page image is complex enough to merit its own external file, with the caching benefits this implies. Less complex elements would not merit an external file (for example the underlines, comprising a line and a disc) and there would be an advantage in specifying them so an HTTP request would not be required.</p>

<p>The immediate thought is a <a href="https://developer.mozilla.org/en-US/docs/data_URIs">data URI</a>, most commonly used with simple PNG images. Would it be possible to place an SVG element within a CSS <code>background-image</code> <code>url</code> value?</p>

<p>Chrome supports unencoded data URIs as <code>url</code>s for <code>background-image</code> CSS properties as follows</p>

<pre><code>'data:image/svg+xml;utf-8,&lt;svg width="33" height="34" xmlns="http://www.w3.org/2000/svg"&gt;&lt;line y2="31.5" x2="30.5" y1="2.5" x1="2.5" stroke-width="5" stroke="#000000" fill="none"/&gt;&lt;/svg&gt;'
</code></pre>

<p>Unencoded data URIs are not supported by Firefox, so initially we encoded using base64. This is not human-readable, of course, which was one of the reasons for choosing SVG to allow easy updating. </p>

<p>As shown in this article, [SVG data URIs can be escaped] (http://stackoverflow.com/questions/11703541/using-a-data-encoded-svg-as-a-css-filter) providing a (partially) readable version of the SVG. </p>

<pre><code>'data:image/svg+xml;%3Csvg%20width%3D%2233%22%20height%3D%2234%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cline%20y2%3D%2231.5%22%20x2%3D%2230.5%22%20y1%3D%222.5%22%20x1%3D%222.5%22%20stroke-width%3D%225%22%20stroke%3D%22%23000000%22%20fill%3D%22none%22/%3E%3C/svg%3E'
</code></pre>

<p>Escaped URIs can be unescaped easily in the browser console, but unlike base64 don't require unescaping in order to be edited.</p>

<h2>Manipulating <code>background-image</code> SVG elements</h2>

<p>The SVG background images (either as files or data URIs) were not only set as background images to elements (as with the main header), but set on the page in <a href="http://nicolasgallagher.com/multiple-backgrounds-and-borders-with-css2/">generated content pseudo-elements</a>. <a href="http://jsfiddle.net/daneastwell/4zk5U/3/">Example of generated content elements here</a>.</p>

<p>This was to avoid any clash with existing background images and to give the decorative elements their own containers.</p>

<p>Once added to the page the background images could be transformed and scaled using CSS3 (proprietary declarations not shown):</p>

<h3>Rotate</h3>

<pre><code>transform: rotate(270deg);
</code></pre>

<p><img src="images/rotate.png" alt="The graphic rotated" title=""></p>

<p>The image is rotated from its standard orientation (with opacity at 50% applied).</p>

<h3>Saturate</h3>

<pre><code>-webkit-filter: saturate(4.8) 
</code></pre>

<p><img src="images/saturate.png" alt="The graphic with saturated colour" title=""></p>

<p>Changes the background image from a standard darker colour to a more saturated colour (this is more useful on an imported SVG where the colours could not be changed in the CSS file). This technique is currently webkit only, though can be achieved with an SVG filter - see below for this technique.</p>

<h3>Flipping</h3>

<pre><code>transform: scaleX(-1); 
</code></pre>

<p><img src="images/reflect.png" alt="The graphic reflected" title=""></p>

<p>There are two generated content elements here (<code>:before</code> and <code>:after</code>). The second is flipped on the x-axis creating a reflection. Both use the same original file as the header.</p>

<p><strong>* show not working in IE9, create a reduced test case, if bug file bug report
  multiple backgrounds (with gradient) *</strong></p>

<h2>Colour changes with Jekyll/Liquid themes</h2>

<p>The key benefit of using SVG background images within our site CSS was to allow colour changes with a site theme. </p>

<p>The sites are using <a href="https://github.com/mojombo/jekyll/">Jekyll</a>/<a href="http://liquidmarkup.org/">Liquid</a> to create project websites. The site uses Jekyll to declare colour variables in a theme file that are then added to any site's CSS as Liquid tags. </p>

<p>For example in the theme file you have <code>link_colour: "#2f4430"</code>, which is evaluated in the main CSS file via the template tag:   </p>

<pre><code>a {
  color: {{ page.link_colour }};
  text-decoration:underline;
}
</code></pre>

<p>This means that creating differing coloured graphical elements is possible with SVG data URIs in a way that is not possible with static images.</p>

<p>Given our need to have escaped data URIs this would give us something like </p>

<pre><code>background-image: url('data:image/svg+xml,%3Csvg%20width%3D%22403%22%20height%3D%228%22%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cline%20stroke%3D%22%23{{ page.subnav_underline }}%22%20stroke-width%3D%222%22%20x1%3D%224%22%20y1%3D%224%22%20x2%3D%22400%22%20y2%3D%224%22%20/%3E%3Ccircle%20fill%3D%22%23{{ page.subnav_underline }}%22%20cx%3D%224%22%20cy%3D%224%22%20r%3D%224%22%20/%3E%3C/svg%3E');
</code></pre>

<p>where the colours are populated as <code>page.subnav_underline</code>.</p>

<h2>SVG grayscale filter and overlay</h2>

<p>The last SVG technique used is a pair that replicate what might formerly have been done in Photoshop and exported as an image. The instructions are shown in this screenshot <img src="/images/ColourOpacity.png" alt="Steps to reproduce image style from Photoshop" title=""> and are replicated in SVG.</p>

<p>Firstly an SVG filter is created to set the background image greyscale,</p>

<pre><code>filter:url(data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%3E%3Cfilter%20id%3D%22desaturate%22%3E%3CfeColorMatrix%20type%3D%22saturate%22%20values%3D%220%22/%3E%3C/filter%3E%3C/svg%3E#desaturate);
</code></pre>

<p>unescaped:</p>

<pre><code>&lt;svg xmlns="http://www.w3.org/2000/svg"&gt;&lt;filter id="desaturate"&gt;&lt;feColorMatrix type="saturate" values="0"/&gt;&lt;/filter&gt;&lt;/svg&gt;
</code></pre>

<p>This technique can be be completed natively in webkit</p>

<pre><code>-webkit-filter: grayscale(1);
</code></pre>

<p>then the semi-transparent colour overlay is applied as an SVG circle, with <code>rgba</code> background and a solid stroke.</p>

<p>Full <a href="http://jsfiddle.net/daneastwell/wVmc4/5/">demo here</a>.</p>

<p>The original asset required from the graphics editing program is this single sprite file <img src="images/icon-sprite.png" alt="The icon sprite image" title=""> and can be viewed on these example project web sites: <a href="http://jquerypromises.com/">jQuery.promises</a> and <a href="http://dharmafly.github.com/pablo">Pablo</a>.</p>

<h2>Benefits of using SVG for graphic Elements in web pages</h2>

<ul>
<li>colour changes - it's far simpler to change a colour than creating multiple images </li>
<li>scaling - an SVG file scaled up is the same file size</li>
<li>editable - icons and simple elements can be edited within a text editor, rather than a graphics package</li>
<li>generally smaller file size, especially when scaled up large - an SVG file will generally have a much smaller file size than an uncompressed PNG, especially if it is a simple design scaled very large.</li>
<li>using data URIs for serving SVG no HTTP requests</li>
</ul>

<h2>Limitations</h2>

<ul>
<li>if you are adding SVG elements from a file to the page an HTTP request has to be made. If the images are complex the file size may be larger and be more processor intensive to render than the equivalent as an image.</li>
</ul>

<h2>Alternatives to SVG </h2>

<p>Font icons are useful for many scaleable colourable icons, such as those created in <a href="http://symbolset.com/">Symbolset</a> and <a href="https://github.com/blog/1106-say-hello-to-octicons">icons used in github</a>. The drawback is that unless you are using standard images, it is not trivial to create custom fonts.</p>